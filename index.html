<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="lib/d3/d3.layout.cloud.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script type="text/javascript" src="lib/dat.gui.js"></script>
  <script src="lib/jquery.lettering.js"></script>
  <script src="lib/Motion.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
  <script src="lib/newMotion.js"> </script>
  <style>
    #canvas {
      margin : 40px;
    }
  </style>
</head>
<body>
<div id="canvas"> 
</div>
<script>
  var Inputs= function() {
    var self = this;
    this.width = 1000;
    this.height = 600;
    this.font = "Helvetica";
    this.message = "Customers who think our waiters are rude should see the manager."
    this.words = [];
    this.emotion = "Neutral";

    this.neuTypes = ['dropIn', 'fadeIn', 'fadeOut', 'spinIn']
    this.negTypes = ['raining', 'scaleDown', 'angry']
    this.posTypes = ['scaleUp', 'wigglyScale', 'happy']

    this.fill = d3.scale.category20();
    this.setTypes = function(emotion) {
      if(emotion=='Positive') return self.posTypes[Math.floor(Math.random() * self.posTypes.length)]
      else if(emotion=='Negative') return self.negTypes[Math.floor(Math.random() * self.negTypes.length)]
      else return self.neuTypes[Math.floor(Math.random() * self.neuTypes.length)]
    }

    this.GENERATE = function() {
      this.words = this.message.split(" ");
      d3.layout.cloud().size([this.width, this.height])
        .words(self.words.map(function(d) {
          return {text: d, size: 24 + Math.random() * 64, type:self.setTypes(self.emotion)}
        }))
        .padding(1)
        .rotate(function() { return 0;/*~~(Math.random() * 2) * 90;*/ })
        .font(this.font)
        .fontSize(function(d) { return d.size; })
        .spiral(newRectangularSpiral)
        .on("end", this.draw)
        .start();
    }

    this.setMotion = (function() {
      return function (self,d, delays) {
        console.log(d.type, delays);
        if (d.type === 'dropIn') {
          var duration = 200;
          d3.select(self).dropIn(1000, duration, delays, duration);
          return delays += duration*(d.letters.length+1);
        } else if (d.type === 'fadeIn'){
          var duration = 400;
          var delayLetter = 200; 
          d3.select(self).fadeIn(duration, delays, delayLetter);
          return delays += delayLetter*(d.letters.length+1)
        } else if (d.type ==='fadeOut') {
          var duration = 400;
          var delayLetter = 200; 
          d3.select(self).fadeOut(duration, delays, delayLetter); 
          return delays += delayLetter*(d.letters.length+1);
        } else {
          var duration = 300;
          d3.select(self).spinIn(-120, 1000-d.x, -d.y, duration, delays, 300);
          return delays += duration*(d.letters.length+1); 
        }

                    /*

            this.neuTypes = ['dropIn', 'fadeIn', 'fadeOut', 'spinIn']
            this.negTypes = ['raining', 'scaleDown', 'angry']
            this.posTypes = ['scaleUp', 'wigglyScale', 'happy']
            switch(i) {
              case 0: 
                d3.select(this).wigglyScale(200, delays); 
                delays += 100*d.letters.length ;
                break;
              case 1: 
                d3.select(this).spinIn(-120, 1000-d.x, -d.y, 400, delays, 300);
                delays += 400*d.letters.length; 
                break;
              case 2: 
                d3.select(this).scaleUp(1000, delays, 0); 
                delays += 400;
                break;
              case 3: 
                d3.select(this).scaleDown(1000, delays, 0); 
                delays += 1000;
                break;
              case 4: 
                d3.select(this).angry(1.5, 30,30, 200, delays);
                delays += 150 * 6;
                break;
              case 5: 
                d3.select(this).fadeIn(200, delays, 100);
                delays += 250
                break;
              case 6: d3.select(this).fadeOut(200, delays, 100); 
                delays += 250
                break;
              case 7: d3.select(this).happy(15, -60, 200, delays, 200); 
                delays += 100 * 8
                break;
              case 8: d3.select(this).raining(10, 20, delays, 800); 
                delays += 100 * d.letters.length
                break;
              default: 
                d3.select(this).dropIn(1000, 200, delays, 100);
                delays += 100
                break;
            
            }*/
      }
    })();

    this.initDraw = function(words) {
      $('#canvas>svg').remove();
      d3.select("#canvas").append("svg")
          .attr("width", self.width)
          .attr("height", self.height)
        .append("g")
          .attr("transform", "translate("+ [self.width/2, self.height/2 + 10] + ")")
        .selectAll("g")
          .data(words)
        .enter().append("g")
          .attr("class", function(d,i) {return "word " + i;})
          .each(function(d,i) {
            lettering(d);
            d3.select(this)
              .selectAll("text")
                .data(d.letters)
              .enter().append("text")
                .attr("id", function(l, li) {return "text-" + i + "-" + li})
                .text(function(l) {return l.letter})
                .style("font-family", self.font)
                .style("fill", function(l) { return self.fill(i); })
                .attr("text-anchor", "middle")
            
          });
    }

    this.draw = function (words) {
      var delays = 400;
      $('#canvas>svg').remove();
      d3.select("#canvas").append("svg")
          .attr("width", self.width)
          .attr("height", self.height)
        .append("g")
          .attr("transform", "translate("+ [self.width/2, self.height/2 + 10] + ")")
        .selectAll("g")
          .data(words)
        .enter().append("g")
          .attr("class", function(d,i) {return "word " + i;})
          .each(function(d,i) {
            lettering(d);
            d3.select(this)
              .selectAll("text")
                .data(d.letters)
              .enter().append("text")
                .attr("id", function(l, li) {return "text-" + i + "-" + li})
                .text(function(l) {return l.letter})
                .style("font-family", self.font)
                .style("fill", function(l) { return self.fill(i); })
                .attr("text-anchor", "middle")
            //d3.select(this).fadeIn(400, delays, 0);
            //delays += 800;
            delays = self.setMotion(this,d,delays);
          })
        .selectAll("text")
        .transition()
        .delay(delays + 1000)
        .duration(800)
        .style("opacity", 1.0)
    }
  }

  $(document).ready(function() {
    var inputs = new Inputs();
    var gui = new dat.GUI();
    gui.add(inputs, 'message');
    gui.add(inputs, 'font', ['Helvetica', "Arial"]);
    gui.add(inputs, 'emotion', ['Neutral', 'Negative', 'Positive']);
    gui.add(inputs, 'GENERATE');
  });


  /*
  var words = ['wigglyScale', 'spinIn' , 'scaleUp', 'scaleDown','angry', 
  'fadeIn', 'fadeOut', 'happy', 'raining', 'dropIn']
  */

  /*["Zero","oooooone", "twooo", "three", "four", "five", 
  "six", "seven", "eeeight","nine", "ten", "eleven", "twelve", "thirteen", 
  "fourteen", "fifteen"]/*[
        "Lorem","ipsum","dolor","sit","amet,","consectetur","adipisicing",
        "elit","sed","do","eiusmod","tempor","incididunt","ut","labore",
        "et","dolore","magna","aliqua"];
        */

  function linearSpiral(size) {
    var dy = 4,
        dx = dy * size[0] / size[1];
        x = 0;
        y = 0;
    return function(t) {
      x += dx *t;
      y += dy *t;
      return [x,y];
    };
    /*
    noise(t)
    x = noise(t) % width
    y = noise(t) / width
    */
  }

  function newRectangularSpiral(size) {
    var dy = 2,
        dx = dy * size[0] / size[1] * 2.5 , // width/height * dy
        x = 0,
        y = 0;
    return function(t) {
      var sign = t < 0 ? -1 : 1;
      // See triangular numbers: T_n = n * (n + 1) / 2.
      switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
        case 0:  x += dx; break;
        case 1:  y += dy; break;
        case 2:  x -= dx; break;
        default: y -= dy; break;
      }
      return [x, y];
    };
  }


  function quarterArchimedeanSpiral(size) {
    var e = size[0] / size[1];
    return function(t) {
      //var theta = t % (2*Math.PI);
      //t = t % (2*Math.PI);
      //theta = Math.max(Math.min(Math.PI*0.1, theta), Math.PI*0.35);
      return [Math.abs(e * (t *= .1) * Math.cos(t)), Math.abs(t * Math.sin(t))];
    };
  }

  
  function rectangularSpiral(size) {
    var dy = 4,
        dx = dy * size[0] / size[1], // width/height * dy
        x = 0,
        y = 0;
    return function(t) {
      var sign = t < 0 ? -1 : 1;
      // See triangular numbers: T_n = n * (n + 1) / 2.
      switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
        case 0:  x += dx; break;
        case 1:  y += dy; break;
        case 2:  x -= dx; break;
        default: y -= dy; break;
      }
      return [x, y];
    };
  }

  function archimedeanSpiral(size) {
    var e = size[0] / size[1];
    return function(t) {
      return [e * (t *= .1) * Math.cos(t), t * Math.sin(t)];
    };
  }

  function lerp(a, b, f){
      return a + f * (b - a);
  }
  
  function lettering(word) {
    var word_letters = [], word_letter_objs = [];
    if (word.text) {
      word_letters = word.text.split('');
    }
    word_letters.forEach(function(l) {
      word_letter_objs.push({letter:l})
    });
    word.letters = word_letter_objs;
  }

  


</script>
</body>