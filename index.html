<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="lib/d3/d3.layout.cloud.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="lib/jquery.lettering.js"></script>
<script src="lib/Motion.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
<script src="lib/newMotion.js"> </script>

<script>
  var fill = d3.scale.category20();
  var words = ['wigglyScale', 'spinIn' , 'scaleUp', 'scaleDown','angry', 
  'fadeIn', 'fadeOut', 'happy', 'dropIn']
  /*["Zero","oooooone", "twooo", "three", "four", "five", 
  "six", "seven", "eeeight","nine", "ten", "eleven", "twelve", "thirteen", 
  "fourteen", "fifteen"]/*[
        "Lorem","ipsum","dolor","sit","amet,","consectetur","adipisicing",
        "elit","sed","do","eiusmod","tempor","incididunt","ut","labore",
        "et","dolore","magna","aliqua"];
        */
  d3.layout.cloud().size([1000, 600])
      .words(words.map(function(d) {
        return {text: d, size: 24 + Math.random() * 64};
      }))
      .padding(1)
      .rotate(function() { return 0;/*~~(Math.random() * 2) * 90;*/ })
      .font("Impact")
      .fontSize(function(d) { return d.size; })
      .spiral(newRectangularSpiral)
      .on("end", draw)
      .start();
  
  function linearSpiral(size) {
    var dy = 4,
        dx = dy * size[0] / size[1];
        x = 0;
        y = 0;
    return function(t) {
      x += dx *t;
      y += dy *t;
      return [x,y];
    };
    /*
    noise(t)
    x = noise(t) % width
    y = noise(t) / width
    */
  }

  function newRectangularSpiral(size) {
    var dy = 2,
        dx = dy * size[0] / size[1] * 2.5 , // width/height * dy
        x = 0,
        y = 0;
    return function(t) {
      var sign = t < 0 ? -1 : 1;
      // See triangular numbers: T_n = n * (n + 1) / 2.
      switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
        case 0:  x += dx; break;
        case 1:  y += dy; break;
        case 2:  x -= dx; break;
        default: y -= dy; break;
      }
      return [x, y];
    };
  }


  function quarterArchimedeanSpiral(size) {
    var e = size[0] / size[1];
    return function(t) {
      //var theta = t % (2*Math.PI);
      //t = t % (2*Math.PI);
      //theta = Math.max(Math.min(Math.PI*0.1, theta), Math.PI*0.35);
      return [Math.abs(e * (t *= .1) * Math.cos(t)), Math.abs(t * Math.sin(t))];
    };
  }

  
  function rectangularSpiral(size) {
    var dy = 4,
        dx = dy * size[0] / size[1], // width/height * dy
        x = 0,
        y = 0;
    return function(t) {
      var sign = t < 0 ? -1 : 1;
      // See triangular numbers: T_n = n * (n + 1) / 2.
      switch ((Math.sqrt(1 + 4 * sign * t) - sign) & 3) {
        case 0:  x += dx; break;
        case 1:  y += dy; break;
        case 2:  x -= dx; break;
        default: y -= dy; break;
      }
      return [x, y];
    };
  }

  function archimedeanSpiral(size) {
    var e = size[0] / size[1];
    return function(t) {
      return [e * (t *= .1) * Math.cos(t), t * Math.sin(t)];
    };
  }
  
  function lettering(word) {
    var word_letters = [], word_letter_objs = [];
    if (word.text) {
      word_letters = word.text.split('');
    }
    word_letters.forEach(function(l) {
      word_letter_objs.push({letter:l})
    });
    word.letters = word_letter_objs;
  }

  function draw(words) {
    var delays = 400;
    d3.select("body").append("svg")
        .attr("width", 800)
        .attr("height", 600)
      .append("g")
        .attr("transform", "translate(500,300)")
      .selectAll("g")
        .data(words)
      .enter().append("g")
        .attr("class", function(d,i) {return "word " + i;})
        .each(function(d,i) {
          lettering(d);
          d3.select(this)
            .selectAll("text")
              .data(d.letters)
            .enter().append("text")
              .attr("id", function(l, li) {return "text-" + i + "-" + li})
              .text(function(l) {return l.letter})
              .style("font-family", "Impact")
              .style("fill", function(l) { return fill(i); })
              .attr("text-anchor", "middle")

              //.style("font-size", function(l) { return d.size + "px"; })
              /*
              .each(function(l, li) {
                var thisW = document.getElementById("text-" + i + "-" + li).getBBox().width;
                d.totalW += thisW;
              })
              */
          switch(i) {

            case 0: 
              d3.select(this).wigglyScale(100, delays); 
              delays += 100*d.letters.length ;
              break;
            case 1: 
              d3.select(this).spinIn(90, 1000-d.x, -d.y, 400, delays, 400);
              delays += 400*d.letters.length; 
              break;
            case 2: 
              d3.select(this).scaleUp(1000, delays, 0); 
              delays += 400;
              break;
            case 3: 
              d3.select(this).scaleDown(1000, delays, 0); 
              delays += 1000;
              break;
            case 4: 
              d3.select(this).angry(1.25, 15, 150, delays);
              delays += 150 * 6;
              break;
            case 5: 
              d3.select(this).fadeIn(200, delays, 100);
              delays += 250
              break;
            case 6: d3.select(this).fadeOut(200, delays, 100); 
              delays += 250
              break;
            case 7: d3.select(this).happy(15, -30, 100, delays, 100*4); 
              delays += 100 * 8
              break;
            default: 
              d3.select(this).dropIn(1000, 200, delays, 100);
              delays += 100
              break;

          }
          //d3.select(this)//.wigglyScale(100, 200*i)
          //.spinIn(90, 1000-d.x, -d.y, 400, 200*i, 400)
          //.scaleUp
          //.angry(1.15, 15, 100, 100*i)//
          //.fadeIn(200, 200*i, 100);
          //.fadeOut
          //.dropIn(1000, 200, 200*i, 100)
          
        })
  }


</script>
